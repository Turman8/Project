# ECG Heart Signal Classification FPGA Implementation

## 项目概述
基于MIT-BIH数据库的ECG心电信号分类系统，采用Q8.8定点量化神经网络在Zynq-7020 FPGA上实现。

**🎉 重大突破**: 16,550个权重参数已完成Q8.8定点转换，实现零浮点FPGA部署！

## 项目结构
```
FPGA/
├── hls_source/                    # HLS源代码
│   ├── classifier.h              # 头文件定义
│   ├── classifier_balanced.cpp   # 平衡版本实现（推荐）
│   ├── classifier_minimal.cpp    # 极简版本实现（资源最少）
│   ├── weights.h                 # Q8.8定点权重头文件 ✅已生成
│   └── weights.cpp               # Q8.8定点权重数据 ✅已生成 (16,550参数)
├── testbench/                     # 测试台
│   └── testbench.cpp             # 功能验证测试
├── build_balanced.tcl            # 平衡版本构建脚本
├── build_minimal.tcl             # 极简版本构建脚本
└── performance_comparison.md     # 性能对比分析
```

## 技术规格

### 神经网络架构
- **输入**: 46维特征（36个db4小波 + 10个时域特征）
- **网络结构**: 46→128→64→32→6 (16,550个权重参数)
- **输出类别**: 6类心律异常（N,L,R,A,V,F）
- **量化格式**: Q8.8定点数（16位整数，精度1/256）
- **权重数据**: 完整32.3KB定点权重文件已生成
- **激活函数**: ReLU（定点实现）

### 硬件目标
- **FPGA型号**: Xilinx Zynq-7020
- **时钟频率**: 150MHz (6.67ns)
- **资源限制**: 220 DSP, 280 BRAM, 53,200 LUT, 106,400 FF

## 版本对比

| 版本 | DSP使用 | 延迟(cycles) | 延迟(时间) | 资源利用率 |
|------|---------|-------------|-----------|-----------|
| **极简版本** | 4 (1.8%) | 19,507 | 0.195ms | 符合所有限制 |
| **平衡版本** | 270 (122%) | 694 | 0.0069ms | DSP超限，其他合理 |

## 快速开始

### 构建极简版本（推荐部署）
```bash
vitis_hls -f build_minimal.tcl
```

### 构建平衡版本（性能分析）
```bash
vitis_hls -f build_balanced.tcl
```

### 验证功能
所有版本均通过完整的C仿真、RTL仿真和协仿真验证。

## 性能指标

### 准确率
- **训练精度**: 99.08%（基于MIT-BIH数据库）
- **量化损失**: <2%（浮点转定点）
- **测试验证**: 通过多种心律模式测试

### 实时性能
- **极简版本**: 满足125-500Hz采样率实时处理要求
- **平衡版本**: 超强性能，支持多通道并行处理

## 部署建议

1. **生产部署**: 使用极简版本
   - 资源利用保守，稳定可靠
   - 满足医疗实时性要求
   - 为系统其他功能预留资源

2. **研究开发**: 基于平衡版本优化
   - 展示了巨大的性能潜力
   - 可通过调整并行度适配硬件限制
   - 适合多通道或高频采样应用

## 开发环境
- **HLS工具**: Vitis HLS 2024.1.2
- **目标器件**: xc7z020clg400-1
- **验证方式**: C-sim + RTL-sim + Co-sim + IP导出
- **权重转换**: `convert_weights_to_fixed.py` 自动化工具

## 权重量化成就 🎯
- ✅ **参数规模**: 16,550个神经网络权重完成转换
- ✅ **存储效率**: 32.3KB Q8.8数据 (比浮点节省51%空间)
- ✅ **精度保持**: Q8.8格式提供1/256精度
- ✅ **零浮点**: 完全消除FPGA中的浮点运算需求

## 下一步计划
1. 创建优化平衡版本（目标150-180 DSP使用）
2. 集成到Vivado项目进行完整系统验证
3. 实际硬件测试和性能分析

---
*最后更新: 2025年7月24日 - 权重量化重大突破完成*
